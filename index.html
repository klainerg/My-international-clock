<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>My International Clock</title>

<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-title" content="Clocks" />

<link rel="manifest" href="./manifest.json" />
<link rel="apple-touch-icon" href="./icon-192.png" />

<style>
  :root { color-scheme: dark; }
  body{
    margin:0;
    color:#fff;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display","SF Pro Text", system-ui, Segoe UI, Roboto, Arial, sans-serif;
    background:
      radial-gradient(900px 600px at 20% 10%, rgba(120,180,255,.22), transparent 55%),
      radial-gradient(900px 700px at 85% 30%, rgba(255,120,200,.16), transparent 60%),
      radial-gradient(700px 700px at 50% 95%, rgba(120,255,200,.12), transparent 55%),
      #000;
  }
  .safe { padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom); }
  .wrap{ max-width: 560px; margin: 0 auto; padding: 14px 14px 22px; }

  .topbar{
    display:flex; align-items:flex-end; justify-content:space-between; gap:10px;
    margin: 10px 2px 12px;
  }
  .title{ font-size: 1.45rem; font-weight: 760; letter-spacing: .2px; }
  .subtitle{ font-size: .82rem; opacity:.72; margin-top:4px; }
  .chip{
    font-size:.78rem;
    padding: 7px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    opacity:.9;
    white-space: nowrap;
  }

  .panel{
    border-radius: 20px;
    padding: 12px 12px 10px;
    margin-bottom: 12px;
    background: rgba(18,18,18,.58);
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 14px 40px rgba(0,0,0,.40);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .panelTitle{ font-size: .95rem; font-weight: 650; }
  .panelSub{ font-size:.78rem; opacity:.65; margin-top:4px; line-height:1.35; }
  .controls{
    margin-top: 10px;
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  }
  button{
    appearance:none;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.07);
    color:#fff;
    border-radius: 14px;
    padding: 10px 12px;
    font-size:.92rem;
    font-weight: 650;
  }
  button:active{ transform: scale(.99); }
  .delta{
    flex: 1 1 140px;
    text-align:center;
    font-variant-numeric: tabular-nums;
    font-size: .92rem;
    opacity: .92;
  }
  .rangeWrap{ flex: 2 1 260px; width: 100%; }
  input[type="range"]{ width: 100%; }

  .grid{ display:grid; gap: 12px; }
  .card{
    border-radius: 20px;
    padding: 14px 14px 12px;
    background: rgba(18,18,18,.62);
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 14px 40px rgba(0,0,0,.45);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
  .city{ font-size: 1.02rem; font-weight: 650; }
  .meta{
    font-size: .78rem; opacity:.72; margin-top:4px;
    display:flex; gap:10px; flex-wrap:wrap;
  }
  .pill{
    display:inline-flex; align-items:center; gap:6px;
    padding: 4px 8px;
    border-radius: 999px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.10);
  }
  .time{
    margin-top: 10px;
    font-size: 2.55rem;
    font-weight: 820;
    letter-spacing: 2px;
    font-variant-numeric: tabular-nums;
  }
  .date{ margin-top: 6px; font-size: .85rem; opacity:.70; }
  .small{ font-size:.8rem; opacity:.70; }

  .picker{ margin-top: 6px; display:flex; gap:10px; flex-wrap:wrap; }
  select, input[type="text"]{
    appearance: none;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    color:#fff;
    border-radius: 14px;
    padding: 10px 12px;
    font-size: .92rem;
    outline: none;
    width: 100%;
  }
  select{ padding-right: 34px; }
  .selectWrap{ position:relative; flex: 1 1 220px; }
  .selectWrap:after{
    content:"‚ñæ";
    position:absolute;
    right: 12px; top: 50%;
    transform: translateY(-50%);
    opacity: .7;
    pointer-events:none;
  }
  .inputWrap{ flex: 2 1 220px; }
  .hint{ margin-top: 8px; font-size:.78rem; opacity:.60; line-height:1.35; }

  .footer{
    text-align:center;
    margin-top: 14px;
    font-size: .78rem;
    opacity: .55;
  }
</style>
</head>

<body>
<div class="safe">
  <div class="wrap">
    <div class="topbar">
      <div>
        <div class="title">My International Clock</div>
        <div class="subtitle">Developer: <b>GuyK</b></div>
      </div>
      <div class="chip" id="status">Live</div>
    </div>

    <div class="panel">
      <div class="panelTitle">Israel time offset</div>
      <div class="panelSub">
        Use this to move the Israel clock forward/backward. All other clocks update according to the shifted Israel time (useful for planning calls).
      </div>
      <div class="controls">
        <button id="minus1h" type="button">‚àí1h</button>
        <button id="minus15" type="button">‚àí15m</button>

        <div class="delta" id="deltaLabel">Offset: +00:00</div>

        <button id="plus15" type="button">+15m</button>
        <button id="plus1h" type="button">+1h</button>
        <button id="reset" type="button">Reset</button>

        <div class="rangeWrap">
          <input id="range" type="range" min="-720" max="720" step="5" value="0" />
          <div class="panelSub" style="margin-top:6px;">Range: ‚àí12h ‚Ä¶ +12h (step 5 minutes)</div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <div class="city">Israel (Local)</div>
          <div class="small" id="dn-il">‚Äî</div>
        </div>
        <div class="meta">
          <span class="pill">üïì <span id="off-il">Base</span></span>
          <span class="pill">üåç <span>Asia/Jerusalem</span></span>
        </div>
        <div class="time" id="t-il">--:--:--</div>
        <div class="date" id="d-il">---</div>
      </div>

      <div class="card">
        <div class="row">
          <div class="city">Ciudad Ju√°rez, Mexico</div>
          <div class="small" id="dn-juarez">‚Äî</div>
        </div>
        <div class="meta">
          <span class="pill">üïì <span id="off-juarez">‚Äî</span></span>
          <span class="pill">üåç <span>America/Ciudad_Juarez</span></span>
        </div>
        <div class="time" id="t-juarez">--:--:--</div>
        <div class="date" id="d-juarez">---</div>
      </div>

      <div class="card">
        <div class="row">
          <div class="city">Irvine, CA, USA</div>
          <div class="small" id="dn-irvine">‚Äî</div>
        </div>
        <div class="meta">
          <span class="pill">üïì <span id="off-irvine">‚Äî</span></span>
          <span class="pill">üåç <span>America/Los_Angeles</span></span>
        </div>
        <div class="time" id="t-irvine">--:--:--</div>
        <div class="date" id="d-irvine">---</div>
      </div>

      <div class="card">
        <div class="row">
          <div class="city" id="custom-title">Custom City</div>
          <div class="small" id="dn-custom">‚Äî</div>
        </div>
        <div class="meta">
          <span class="pill">üïì <span id="off-custom">‚Äî</span></span>
          <span class="pill">üåç <span id="tz-custom-label">‚Äî</span></span>
        </div>

        <div class="picker">
          <div class="selectWrap">
            <select id="custom-select" aria-label="Choose a city">
              <option value="Europe/London">London</option>
              <option value="Europe/Paris">Paris</option>
              <option value="Europe/Berlin">Berlin</option>
              <option value="Europe/Rome">Rome</option>
              <option value="Europe/Athens">Athens</option>
              <option value="America/New_York">New York</option>
              <option value="America/Chicago">Chicago</option>
              <option value="America/Denver">Denver</option>
              <option value="America/Los_Angeles">Los Angeles</option>
              <option value="America/Mexico_City">Mexico City</option>
              <option value="Asia/Dubai">Dubai</option>
              <option value="Asia/Kolkata">India (Kolkata)</option>
              <option value="Asia/Tokyo">Tokyo</option>
              <option value="Australia/Sydney">Sydney</option>
              <option value="custom">Custom time zone‚Ä¶</option>
            </select>
          </div>
          <div class="inputWrap">
            <input id="custom-input" type="text" placeholder="e.g., America/Toronto (IANA time zone)" />
          </div>
        </div>

        <div class="time" id="t-custom">--:--:--</div>
        <div class="date" id="d-custom">---</div>
        <div class="hint">
          Pick a city or enter an IANA time zone (e.g., <b>America/Toronto</b>, <b>Asia/Singapore</b>). Saved on this device.
        </div>
      </div>
    </div>

    <div class="footer">Day/Night is based on local hour (06:00‚Äì17:59 = day).</div>
  </div>
</div>

<script>
  const TZ_IL = "Asia/Jerusalem";

  const fmtTime = (tz, now) => new Intl.DateTimeFormat("en-GB", {
    timeZone: tz, hour: "2-digit", minute: "2-digit", second: "2-digit", hourCycle: "h23"
  }).format(now);

  const fmtDate = (tz, now) => new Intl.DateTimeFormat("en-US", {
    timeZone: tz, weekday: "long", month: "short", day: "2-digit"
  }).format(now);

  const getHour = (tz, now) => {
    const s = new Intl.DateTimeFormat("en-GB", { timeZone: tz, hour: "2-digit", hourCycle: "h23" }).format(now);
    const h = parseInt(s, 10);
    return Number.isFinite(h) ? h : 0;
  };

  const dayNight = (hour) => (hour >= 6 && hour < 18) ? "‚òÄÔ∏è Day" : "üåô Night";

  // Offset of a timezone at 'now', in minutes. Handles DST and non-integer offsets.
  const tzOffsetMinutes = (tz, now) => {
    const parts = new Intl.DateTimeFormat("en-US", {
      timeZone: tz,
      year: "numeric", month: "2-digit", day: "2-digit",
      hour: "2-digit", minute: "2-digit", second: "2-digit",
      hourCycle: "h23"
    }).formatToParts(now);
    const get = (type) => parts.find(p => p.type === type)?.value;
    const y = get("year"), mo = get("month"), d = get("day"),
          h = get("hour"), mi = get("minute"), s = get("second");
    const asUTC = Date.UTC(+y, +mo - 1, +d, +h, +mi, +s);
    return Math.round((asUTC - now.getTime()) / 60000);
  };

  const formatDiff = (diffMin) => {
    if (diffMin === 0) return "Same as Israel";
    const sign = diffMin > 0 ? "+" : "-";
    const abs = Math.abs(diffMin);
    const hours = Math.floor(abs / 60);
    const mins = abs % 60;
    if (mins === 0) return `${sign}${hours}h vs Israel`;
    return `${sign}${hours}:${String(mins).padStart(2,"0")} vs Israel`;
  };

  // --- Israel shift controls (minutes) ---
  const KEY_SHIFT = "il_shift_minutes";
  let shiftMin = parseInt(localStorage.getItem(KEY_SHIFT) || "0", 10);
  if (!Number.isFinite(shiftMin)) shiftMin = 0;

  const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
  const setShift = (v) => {
    shiftMin = clamp(v, -720, 720);
    localStorage.setItem(KEY_SHIFT, String(shiftMin));
    range.value = String(shiftMin);
    deltaLabel.textContent = "Offset: " + formatHM(shiftMin);
    status.textContent = "Live";
  };

  const formatHM = (min) => {
    const sign = min >= 0 ? "+" : "-";
    const a = Math.abs(min);
    const h = Math.floor(a / 60);
    const m = a % 60;
    return `${sign}${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
  };

  // --- Custom city selection ---
  const selectEl = document.getElementById("custom-select");
  const inputEl  = document.getElementById("custom-input");
  const customTitle = document.getElementById("custom-title");
  const tzCustomLabel = document.getElementById("tz-custom-label");

  const saveCustom = (tz, label) => {
    localStorage.setItem("custom_tz", tz);
    localStorage.setItem("custom_label", label || tz);
  };
  const loadCustom = () => {
    const tz = localStorage.getItem("custom_tz");
    const label = localStorage.getItem("custom_label");
    return { tz, label };
  };
  const setCustom = (tz, label) => {
    window.__CUSTOM_TZ__ = tz;
    customTitle.textContent = label || "Custom City";
    tzCustomLabel.textContent = tz || "‚Äî";
  };
  const trySetCustomTZ = (tz, label) => {
    try {
      new Intl.DateTimeFormat("en-US", { timeZone: tz }).format(new Date());
      setCustom(tz, label);
      saveCustom(tz, label);
      status.textContent = "Saved";
      setTimeout(()=>status.textContent="Live", 700);
      return true;
    } catch {
      status.textContent = "Invalid time zone";
      setTimeout(()=>status.textContent="Live", 1200);
      return false;
    }
  };

  (function initCustom(){
    const saved = loadCustom();
    if (saved.tz) {
      setCustom(saved.tz, saved.label || saved.tz);
      const opt = [...selectEl.options].find(o => o.value === saved.tz);
      selectEl.value = opt ? saved.tz : "custom";
      inputEl.value = saved.tz;
    } else {
      selectEl.value = "Europe/London";
      inputEl.value = "";
      trySetCustomTZ("Europe/London", "London");
    }
    inputEl.style.display = (selectEl.value === "custom") ? "block" : "none";
  })();

  selectEl.addEventListener("change", () => {
    if (selectEl.value === "custom") {
      inputEl.style.display = "block";
      inputEl.focus();
      return;
    }
    inputEl.style.display = "none";
    const label = selectEl.options[selectEl.selectedIndex].textContent || "Custom City";
    trySetCustomTZ(selectEl.value, label);
  });

  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      const tz = inputEl.value.trim();
      if (tz) trySetCustomTZ(tz, tz);
      inputEl.blur();
    }
  });

  // --- Hook controls ---
  const status = document.getElementById("status");
  const deltaLabel = document.getElementById("deltaLabel");
  const range = document.getElementById("range");

  document.getElementById("minus1h").addEventListener("click", ()=> setShift(shiftMin - 60));
  document.getElementById("plus1h").addEventListener("click", ()=> setShift(shiftMin + 60));
  document.getElementById("minus15").addEventListener("click", ()=> setShift(shiftMin - 15));
  document.getElementById("plus15").addEventListener("click", ()=> setShift(shiftMin + 15));
  document.getElementById("reset").addEventListener("click", ()=> setShift(0));
  range.addEventListener("input", ()=> { status.textContent = "Live"; setShift(parseInt(range.value,10)); });

  // Init label/slider
  range.value = String(shiftMin);
  deltaLabel.textContent = "Offset: " + formatHM(shiftMin);

  // --- Clocks update ---
  function updateAll(){
    const realNow = new Date();
    const now = new Date(realNow.getTime() + shiftMin * 60000); // shifted Israel reference time

    // Offsets vs Israel should use the same shifted instant (still valid for planning)
    const ilOff = tzOffsetMinutes(TZ_IL, now);

    // Israel
    document.getElementById("t-il").textContent = fmtTime(TZ_IL, now);
    document.getElementById("d-il").textContent = fmtDate(TZ_IL, now);
    document.getElementById("dn-il").textContent = dayNight(getHour(TZ_IL, now));
    document.getElementById("off-il").textContent = shiftMin === 0 ? "Base" : ("Shift " + formatHM(shiftMin));

    // Juarez
    const tzJ = "America/Ciudad_Juarez";
    document.getElementById("t-juarez").textContent = fmtTime(tzJ, now);
    document.getElementById("d-juarez").textContent = fmtDate(tzJ, now);
    document.getElementById("dn-juarez").textContent = dayNight(getHour(tzJ, now));
    document.getElementById("off-juarez").textContent = formatDiff(tzOffsetMinutes(tzJ, now) - ilOff);

    // Irvine
    const tzI = "America/Los_Angeles";
    document.getElementById("t-irvine").textContent = fmtTime(tzI, now);
    document.getElementById("d-irvine").textContent = fmtDate(tzI, now);
    document.getElementById("dn-irvine").textContent = dayNight(getHour(tzI, now));
    document.getElementById("off-irvine").textContent = formatDiff(tzOffsetMinutes(tzI, now) - ilOff);

    // Custom
    const ctz = window.__CUSTOM_TZ__;
    if (ctz) {
      document.getElementById("t-custom").textContent = fmtTime(ctz, now);
      document.getElementById("d-custom").textContent = fmtDate(ctz, now);
      document.getElementById("dn-custom").textContent = dayNight(getHour(ctz, now));
      document.getElementById("off-custom").textContent = formatDiff(tzOffsetMinutes(ctz, now) - ilOff);
    }
  }

  updateAll();
  setInterval(updateAll, 1000);

  // PWA service worker (HTTPS required)
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  }
</script>
</body>
</html>
